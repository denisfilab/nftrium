{% extends 'base.html' %}
{% block meta %}
<title>Main Page</title>
{% endblock meta %}
{% block content %}
{% load static %}

<!-- Carousel Section -->
<div id="carousel-section" class="relative w-full overflow-hidden h-[700px] sm:h-[700px] md:h-[700px] lg:h-[700px]">
    <!-- Carousel Backgrounds -->
    <div id="carousel-backgrounds" class="absolute inset-0 flex transition-transform duration-500 z-0">
        {% for image in images %}
        <div class="min-w-full h-full">
            <div class="h-full w-full bg-cover bg-center filter blur-lg" style="background-image: url('{{image.path}}');"></div>
=        </div>
        {% endfor %}
    </div>

    <!-- Gradient Overlay -->
    <div class="gradient-overlay absolute inset-0 z-10 pointer-events-none"></div>

    <!-- Carousel Container -->
    <div class="relative z-20 flex items-center justify-center h-full">
        <div id="carousel" class="flex transition-transform duration-500">
            <!-- Carousel Items -->
            {% for image in images %}
            <div class="carousel-item flex-shrink-0">
                <div class="relative overflow-hidden rounded-lg">
                    <img src="{{ image.path }}" alt="{{ image }}" class="w-full h-auto object-cover rounded-lg transform hover:scale-110 transition-transform duration-300" loading="lazy">
                    <!-- Overlay Information -->
                    <div class="absolute bottom-0 left-0 right-0 text-white p-4">
                        <p>Price: ${{ image.price }}</p>
                        <p>Name: {{ image.name }}</p>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Navigation Buttons -->
    <button id="prev-btn" class="absolute left-4 top-1/2 transform -translate-y-1/2 z-30 bg-white bg-opacity-50 hover:bg-opacity-75 p-2 rounded-full focus:outline-none">
        &#10094;
    </button>
    <button id="next-btn" class="absolute right-4 top-1/2 transform -translate-y-1/2 z-30 bg-white bg-opacity-50 hover:bg-opacity-75 p-2 rounded-full focus:outline-none">
        &#10095;
    </button>
</div>

<div class="p-16 w-full min-h-screen bg-[#00040F]">
    <h1 class="text-3xl font-bold mb-4 text-center text-white">Your NFT Product</h1>
    <h3 class="mb-8 font-bold text-xl text-center text-white">
        You have {{ count }} NFTs product
    </h3>
    <div class="container mx-auto px-4">
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 auto-cols-auto">
            {% for nft in nfts %}
                {% include 'components/nftcard.html' with nft=nft %}
            {% empty %}
            <p class="text-center text-gray-50  0 col-span-full">
                No NFTs available at the moment.
            </p>
            {% endfor %}
        </div>
    </div>

    <div class="w-full max-w-4xl mx-auto mt-8">
        <div class="flex flex-col sm:flex-row justify-between items-center p-6 rounded-lg shadow-md"
            style="background: linear-gradient(
            -168.39deg,
            #ffffff -278.56%,
            #6d6d6d -78.47%,
            #11101d 91.61%
        );">
            <div class="flex items-center space-x-4 mb-4 sm:mb-0">
                <a href="{% url 'main:create_nft_entry' %}">
                    <button class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-full shadow-lg transition transform hover:scale-105 focus:outline-none">
                        Add a New NFT
                    </button>
                </a>

                <a href="{% url 'main:logout' %}">
                    <button class="bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-full shadow-lg transition transform hover:scale-105 focus:outline-none">
                        Logout
                    </button>
                </a>
            </div>

            <div class="text-center sm:text-right">
                <h5 class="text-gray-600">Last Login: {{ last_login }}</h5>
            </div>
        </div>
    </div>
</div>


<script>
    // Modal Functions
    function openModal(modalId) {
        document.getElementById(modalId).classList.remove("hidden");
    }

    function closeModal(modalId) {
        document.getElementById(modalId).classList.add("hidden");
    }

    // Close modal when clicking outside
    window.onclick = function(event) {
        const modals = document.querySelectorAll('[id^="modal-delete-"]');
        modals.forEach((modal) => {
            if (event.target == modal) {
                modal.classList.add("hidden");
            }
        });
    };

    // Carousel Script
    document.addEventListener('DOMContentLoaded', function() {
        const carousel = document.getElementById('carousel');
        const backgroundCarousel = document.getElementById('carousel-backgrounds');
        const carouselItems = document.querySelectorAll('.carousel-item');
        const totalItems = carouselItems.length;
        let currentIndex = 0;
        let imagesPerView = getImagesPerView();
        let slideInterval;

        function getImagesPerView() {
            if (window.innerWidth >= 1024) { // lg
                return 4;
            } else if (window.innerWidth >= 768) { // md
                return 3;
            } else if (window.innerWidth >= 640) { // sm
                return 2;
            } else { // mobile
                return 1;
            }
        }

        function updateCarousel() {
            imagesPerView = getImagesPerView();
            const maxIndex = totalItems - imagesPerView;
            if (currentIndex > maxIndex) {
                currentIndex = 0;
            } else if (currentIndex < 0) {
                currentIndex = maxIndex;
            }
            const offsetPercentage = -(currentIndex * (100 / imagesPerView));
            carousel.style.transform = `translateX(${offsetPercentage}%)`;
            backgroundCarousel.style.transform = `translateX(${offsetPercentage}%)`;
        }

        function nextSlide() {
            currentIndex += 1;
            updateCarousel();
        }

        function prevSlide() {
            currentIndex -= 1;
            updateCarousel();
        }

        document.getElementById('next-btn').addEventListener('click', function() {
            nextSlide();
            resetInterval();
        });

        document.getElementById('prev-btn').addEventListener('click', function() {
            prevSlide();
            resetInterval();
        });

        // Auto-slide every 4 seconds
        function startInterval() {
            slideInterval = setInterval(nextSlide, 4000);
        }

        function resetInterval() {
            clearInterval(slideInterval);
            startInterval();
        }

        // Update carousel on window resize
        window.addEventListener('resize', function() {
            const oldImagesPerView = imagesPerView;
            imagesPerView = getImagesPerView();
            if (oldImagesPerView !== imagesPerView) {
                updateCarousel();
            }
        });

        // Initialize
        updateCarousel();
        startInterval();
    });
</script>
{% endblock content %}