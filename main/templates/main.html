{% extends 'base.html' %}
{% block meta %}
{% load static %}
<title>Main Page</title>
{% endblock meta %}
{% block content %}

<!-- Carousel Section -->
<div id="carousel-section" class="relative w-full overflow-hidden h-[700px] sm:h-[700px] md:h-[700px] lg:h-[700px]">
    <!-- Carousel Backgrounds -->
    <div id="carousel-backgrounds" class="absolute inset-0 flex transition-transform duration-500 z-0">
        {% for image in images %}
        <div class="min-w-full h-full">
            {% with image_path="image/"|add:image.path %}
            <div class="h-full w-full bg-cover bg-center filter blur-lg" style="background-image: url('{% static image_path %}');"></div>
            {% endwith %}
        </div>
        {% endfor %}
    </div>

    <!-- Gradient Overlay -->
    <div class="gradient-overlay absolute inset-0 z-10 pointer-events-none"></div>

    <!-- Carousel Container -->
    <div class="relative z-20 flex items-center justify-center h-full">
        <div id="carousel" class="flex transition-transform duration-500">
            <!-- Carousel Items -->
            {% for image in images %}
            <div class="carousel-item flex-shrink-0">
                <div class="relative overflow-hidden rounded-lg">
                    {% with image_path="image/"|add:image.path %}
                    <img src="{% static image_path %}" alt="{{ image }}" class="w-full h-auto object-cover rounded-lg transform hover:scale-110 transition-transform duration-300">
                    {% endwith %}
                    <!-- Overlay Information -->
                    <div class="absolute bottom-0 left-0 right-0 text-white p-4">
                        <p>Price: ${{ image.price }}</p>
                        <p>Name: {{ image.name }}</p>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Navigation Buttons -->
    <button id="prev-btn" class="absolute left-4 top-1/2 transform -translate-y-1/2 z-30 bg-white bg-opacity-50 hover:bg-opacity-75 p-2 rounded-full focus:outline-none">
        &#10094;
    </button>
    <button id="next-btn" class="absolute right-4 top-1/2 transform -translate-y-1/2 z-30 bg-white bg-opacity-50 hover:bg-opacity-75 p-2 rounded-full focus:outline-none">
        &#10095;
    </button>
</div>

<!-- Rest of your content -->
<div class="p-16 w-full min-h-screen bg-gray-50">
    <h1 class="text-3xl font-bold mb-4 text-center">NFT Collection</h1>
    <h3 class="mb-8 font-bold text-xl text-center text-gray-700">
        Created by Daanish Inayat Rahman - 2306213136 - PBP A
    </h3>
    <div class="flex flex-col justify-center items-center">
        <div class="w-full grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-6">
            {% for nft in nfts %}
            <div class="nft-item">
                {% include 'components/nftcard.html' with nft=nft %}
            </div>
            {% empty %}
            <p class="text-center text-gray-500">
                No NFTs available at the moment.
            </p>
            {% endfor %}
        </div>
    </div>

    <div class="w-full max-w-4xl mx-auto mt-8">
        <div class="flex flex-col sm:flex-row justify-between items-center bg-white p-6 rounded-lg shadow-md">
            <div class="flex items-center space-x-4 mb-4 sm:mb-0">
                <a href="{% url 'main:create_nft_entry' %}">
                    <button class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded-full shadow-lg transition transform hover:scale-105 focus:outline-none">
                        Add a New NFT
                    </button>
                </a>

                <a href="{% url 'main:logout' %}">
                    <button class="bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded-full shadow-lg transition transform hover:scale-105 focus:outline-none">
                        Logout
                    </button>
                </a>
            </div>

            <div class="text-center sm:text-right">
                <h5 class="text-gray-600">Last Login: {{ last_login }}</h5>
            </div>
        </div>
    </div>
</div>

<!-- Include Styles -->
<style>
    /* Carousel Section */
    #carousel-section {
        position: relative;
    }

    /* Carousel Backgrounds */
    #carousel-backgrounds {
        position: absolute;
        inset: 0;
        display: flex;
        transition: transform 0.5s ease;
        z-index: 0;
    }
    #carousel-backgrounds > div {
        min-width: 100%;
    }
    #carousel-backgrounds .bg-cover {
        width: 100%;
        height: 100%;
        background-size: cover;
        background-position: center;
    }

    /* Gradient Overlay */
    .gradient-overlay {
        position: absolute;
        inset: 0;
        background: linear-gradient(to top, rgba(249, 250, 251, 1), rgba(255, 255, 255, 0));
        z-index: 10;
        pointer-events: none;
    }

    /* Carousel */
    #carousel {
        display: flex;
        transition: transform 0.5s ease;
    }
    .carousel-item {
        flex: 0 0 100%;
        padding: 0 10px; 
    }
    #carousel img {
        width: 450px;
        height: 450px;
        object-fit: cover;
        border-radius: 0.5rem; 
    }

    /* Responsive Carousel Items */
    @media (min-width: 640px) { 
        .carousel-item {
            flex: 0 0 50%; 
        }
    }
    @media (min-width: 768px) {
        .carousel-item {
            flex: 0 0 33.3333%; 
        }
    }
    @media (min-width: 1024px) {
        .carousel-item {
            flex: 0 0 25%; 
        }
    }

    /* Navigation Buttons */
    #prev-btn, #next-btn {
        width: 50px;
        height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
    }

    /* buttons */
    @media (max-width: 640px) {
        #prev-btn, #next-btn {
            top: auto;
            bottom: 10px;
            left: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
        }
    }

    #prev-btn, #next-btn {
        z-index: 30;
    }

    #prev-btn:hover, #next-btn:hover {
        background-opacity: 0.75;
    }
</style>

<script>
    // Modal Functions
    function openModal(modalId) {
        document.getElementById(modalId).classList.remove("hidden");
    }

    function closeModal(modalId) {
        document.getElementById(modalId).classList.add("hidden");
    }

    // Close modal when clicking outside
    window.onclick = function(event) {
        const modals = document.querySelectorAll('[id^="modal-delete-"]');
        modals.forEach((modal) => {
            if (event.target == modal) {
                modal.classList.add("hidden");
            }
        });
    };

    // Carousel Script
    document.addEventListener('DOMContentLoaded', function() {
        const carousel = document.getElementById('carousel');
        const backgroundCarousel = document.getElementById('carousel-backgrounds');
        const carouselItems = document.querySelectorAll('.carousel-item');
        const totalItems = carouselItems.length;
        let currentIndex = 0;
        let imagesPerView = getImagesPerView();
        let slideInterval;

        function getImagesPerView() {
            if (window.innerWidth >= 1024) { // lg
                return 4;
            } else if (window.innerWidth >= 768) { // md
                return 3;
            } else if (window.innerWidth >= 640) { // sm
                return 2;
            } else { // mobile
                return 1;
            }
        }

        function updateCarousel() {
            imagesPerView = getImagesPerView();
            const maxIndex = totalItems - imagesPerView;
            if (currentIndex > maxIndex) {
                currentIndex = 0;
            } else if (currentIndex < 0) {
                currentIndex = maxIndex;
            }
            const offsetPercentage = -(currentIndex * (100 / imagesPerView));
            carousel.style.transform = `translateX(${offsetPercentage}%)`;
            backgroundCarousel.style.transform = `translateX(${offsetPercentage}%)`;
        }

        function nextSlide() {
            currentIndex += 1;
            updateCarousel();
        }

        function prevSlide() {
            currentIndex -= 1;
            updateCarousel();
        }

        document.getElementById('next-btn').addEventListener('click', function() {
            nextSlide();
            resetInterval();
        });

        document.getElementById('prev-btn').addEventListener('click', function() {
            prevSlide();
            resetInterval();
        });

        // Auto-slide every 4 seconds
        function startInterval() {
            slideInterval = setInterval(nextSlide, 4000);
        }

        function resetInterval() {
            clearInterval(slideInterval);
            startInterval();
        }

        // Update carousel on window resize
        window.addEventListener('resize', function() {
            const oldImagesPerView = imagesPerView;
            imagesPerView = getImagesPerView();
            if (oldImagesPerView !== imagesPerView) {
                updateCarousel();
            }
        });

        // Initialize
        updateCarousel();
        startInterval();
    });
</script>
{% endblock content %}